#include<reg52.h>
#define uchar unsigned char
#define uint unsigned int
uint flag = 1;
//选择的参数:1.方波 2.锯齿波 3.正弦波 4.三角波
uint triangle = 0;//三角波的变量
uint sanjiaof = 0;
uint f = 0;//三角波的标识
sbit fangbo = P3^4;
sbit juchi = P3^5;
sbit zhengxian = P3^6;
sbit sanjiao = P3^7;
uchar code sin1[256]={//正弦波的函数数组,放进程序存储器中
0x80,0x83,0x86,0x89,0x8D,0x90,0x93,0x96,
0x99,0x9C,0x9F,0xA2,0xA5,0xA8,0xAB,0xAE,
0xB1,0xB4,0xB7,0xBA,0xBC,0xBF,0xC2,0xC5,
0xC7,0xCA,0xCC,0xCF,0xD1,0xD4,0xD6,0xD8,
0xDA,0xDD,0xDF,0xE1,0xE3,0xE5,0xE7,0xE9,
0xEA,0xEC,0xEE,0xEF,0xF1,0xF2,0xF4,0xF5,
0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,
0xFD,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFD,
0xFD,0xFC,0xFB,0xFA,0xF9,0xF8,0xF7,0xF6,
0xF5,0xF4,0xF2,0xF1,0xEF,0xEE,0xEC,0xEA,
0xE9,0xE7,0xE5,0xE3,0xE1,0xDE,0xDD,0xDA,
0xD8,0xD6,0xD4,0xD1,0xCF,0xCC,0xCA,0xC7,
0xC5,0xC2,0xBF,0xBC,0xBA,0xB7,0xB4,0xB1,
0xAE,0xAB,0xA8,0xA5,0xA2,0x9F,0x9C,0x99,
0x96,0x93,0x90,0x8D,0x89,0x86,0x83,0x80,
0x80,0x7C,0x79,0x78,0x72,0x6F,0x6C,0x69,
0x66,0x63,0x60,0x5D,0x5A,0x57,0x55,0x51,
0x4E,0x4C,0x48,0x45,0x43,0x40,0x3D,0x3A,
0x38,0x35,0x33,0x30,0x2E,0x2B,0x29,0x27,
0x25,0x22,0x20,0x1E,0x1C,0x1A,0x18,0x16,
0x15,0x13,0x11,0x10,0x0E,0x0D,0x0B,0x0A,
0x09,0x08,0x07,0x06,0x05,0x04,0x03,0x02,
0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,
0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,
0x0A,0x0B,0x0D,0x0E,0x10,0x11,0x13,0x15,
0x16,0x18,0x1A,0x1C,0x1E,0x20,0x22,0x25,
0x27,0x29,0x2B,0x2E,0x30,0x33,0x35,0x38,
0x3A,0x3D,0x40,0x43,0x45,0x48,0x4C,0x4E,
0x51,0x55,0x57,0x5A,0x5D,0x60,0x63,0x66,
0x69,0x6C,0x6F,0x72,0x76,0x79,0x7C,0x80
};
uchar *p = sin1;//指向数组头的指针
uchar *p1 = sin1+255;//指向数组尾的指针
/*延时函数,时间为10ms * del
  输入:del
  输出:无*/
void Delay(int del){
	int i,j;
	for(i = 0; i < del ;i++)
	for(j = 0; j < 5; j++);
}
/*********************************************
* 名称 : Outside_Init( )
* 功能 : 外部中断0 初始化
*********************************************/
void Outside_Init(void){
	IT0 = 1; // 下降沿触发
}
/*********************************************
* Time0_Init( )
* 定时器的初始化,11.0592MZ晶振,50ms
*********************************************/
void Time0_Init( ){
	TMOD = 0x01;//0000 0001
	TH0 = 0x4c;//写入初值
	TL0 = 0x00;
	TR0 = 1;//启动
}
/*********************************************
* Time0_Int( )
* 定时器中断,中断中实现Count加一
*********************************************/
void Time0_Int( ) interrupt 1{//定时/计数器的中断号
  TH0 = 0xff;
  TL0 = 0xe0;
  if(flag == 1){//方波的产生函数
    P0=0x01;
    Delay(100);
    P0 = 0xff;
    Delay(100);
  }
  if(flag == 2){//锯齿波的产生函数
    P0 = sanjiaof;
    sanjiaof++;
    if(sanjiaof >= 0xff) sanjiaof = 0x00;
  }
  if(flag == 3){//正弦波的产生函数
    P0 = *p;
		p++;
		if(p>= p1)
			p = sin1;
	}
	if(flag == 4){
		if( f == 0) triangle++;
		if(triangle >= 0xff) f = 1;
		if( f == 1) triangle--;
		if(triangle <= 0x01) f = 0;
		P0=triangle;
	}
}
void main(){
	Time0_Init( );
	Outside_Init( );
	IE = 0x83;
	//while(1);//开定时器中断和外部中断
while(1){
	while(flag == 0){//没有波形
	P0=0x00;
	Delay(1);
}
while(flag == 1){//方波
	P0=0x01;
	Delay(1);
	P0 = 0xff;
	Delay(1);
}
while(flag == 2){//锯齿波
	P0 = sanjiaof;
	sanjiaof++;
	if(sanjiaof >= 0xff) sanjiaof = 0x00;
}
while(flag == 3){//正弦波
  P0 = *p;
  p++;
	if(p>= p1)
	p = sin1;
}
while(flag == 4){//三角波
  if( f == 0) triangle++;
	if(triangle >= 0xff) f = 1;
	if( f == 1) triangle--;
	if(triangle <= 0x01) f = 0;
	P0=triangle;
	Delay(1);
	}
}
}
void Outside_Int(void) interrupt 0{//外部中断0
	if(fangbo == 0) flag = 1;
	if(juchi == 0) flag = 2;
	if(zhengxian == 0) flag = 3;
	if(sanjiao == 0) flag = 4;
}